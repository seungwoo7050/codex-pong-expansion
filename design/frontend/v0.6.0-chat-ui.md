# v0.6.0 채팅 UI 설계

## 1. 목적
- DM/로비/매치 채팅을 기존 친구/로비/게임 화면에 통합해 실시간 소통을 가능하게 한다.

## 2. 화면/흐름
- 친구 페이지
  - 친구 목록 클릭 시 DM 패널이 열리고 `/api/chat/dm/{id}` 히스토리를 불러온다.
  - 입력창에서 DM 전송 시 WebSocket `DM_SEND`와 REST POST를 함께 호출해 저장/실시간 반영.
- 로비 페이지
  - 패널 내에서 로비 채팅 목록을 보여주고 WebSocket 수신시 즉시 갱신.
  - `sendLobby` 버튼으로 메시지 전송, 초기 로딩은 `/api/chat/lobby` 활용.
- 게임 페이지
  - 경기 화면 하단에 매치 채팅 박스를 노출, roomId 기반으로 `SUBSCRIBE_MATCH` 후 히스토리 로딩.
  - 입력 시 WebSocket `MATCH_SEND`와 REST POST 병행.

## 3. 상태/데이터
- 공통 타입: `ChatMessage { id, channelType, channelKey, senderNickname, content, createdAt }`.
- React Query 대신 간단한 상태 배열로 히스토리 관리, 초기 fetch 후 WebSocket 수신 시 append.
- `useChatSocket` 훅으로 `/ws/chat` 연결 상태와 전송 헬퍼(DM/로비/매치/구독)를 제공.

## 4. 에러/가드
- 토큰 없으면 WebSocket 연결을 생성하지 않고 fetch 실패 시 화면에 상태 메시지 표기.
- 빈 메시지 전송을 막고, REST 호출 실패 시 사용자에게 경고 문구 출력.

## 5. 테스트 전략
- `FriendsPage.test.tsx`에서 WebSocket/REST를 목업해 DM 패널 추가 후에도 친구/요청 흐름이 정상 렌더링되는지 확인.
- 추가적인 e2e는 추후 브라우저 환경에서 로비/매치 실시간 동작을 검증한다.
