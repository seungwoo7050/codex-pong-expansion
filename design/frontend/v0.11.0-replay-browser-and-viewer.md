# v0.11.0 리플레이 브라우저 & 뷰어 설계

## 1. 목적
- 경기 종료 후 사용자가 자신의 경기를 다시 볼 수 있도록 **리플레이 목록 및 재생 UI**를 제공한다.
- 기존 게임 캔버스를 재사용해 실시간 플레이와 동일한 시각적 경험을 유지한다.

## 2. 범위
- "내 리플레이" 화면: 목록·검색(상대 닉네임)·길이/결과 표시·뷰어 이동 버튼.
- "리플레이 뷰어" 화면: 재생/일시정지, 시크, 배속(0.5/1/2), 읽기 전용 캔버스 렌더링.
- 백엔드가 제공하는 `application/x-ndjson` 스트림(JSONL_V1)을 파싱해 재생.
- 신규 WebSocket 이벤트는 없음(사후 기능만 처리).

## 3. 화면/흐름
### 3.1 리플레이 목록
- 라우트: `/replays` (보호 라우트).
- API: `GET /api/replays?page=0&size=20` → `ReplaySummary` 배열.
- 열: 생성 일시, 상대 닉네임, 결과(스코어+승/무/패), 길이(분:초), "뷰어 열기" 링크(`/replays/{id}`).
- 검색: 입력 문자열을 상대 닉네임에 `includes` 필터로 적용(클라이언트 측).

### 3.2 리플레이 뷰어
- 라우트: `/replays/:replayId` (보호 라우트).
- 단계:
  1) `GET /api/replays/{id}` → 메타데이터+`downloadPath` 확보.
  2) `GET {downloadPath}` → NDJSON 파싱(`offsetMs`, `snapshot`).
  3) `GameCanvas`에 현재 스냅샷 전달, 컨트롤 패널에서 재생/배속/시크 제어.
- 타임라인: `setInterval`로 50ms 간격 업데이트, `speed` 배율 적용, 시크 시 재생 정지 후 해당 오프셋 스냅샷을 즉시 적용.
- 표시 정보: 상대 닉네임, 스코어, 총 길이, 현재 경과 시간.

## 4. 컴포넌트/상태 구조
- `GameCanvas` (shared): 캔버스/점수판을 렌더링하는 공용 컴포넌트. 실시간 `GamePage`와 리플레이가 모두 사용.
- `MyReplaysPage`: 목록+검색, 로딩/에러 상태 표시.
- `ReplayViewerPage`: 메타/이벤트 로드, `positionMs`/`playing`/`speed` 상태 관리, 슬라이더·버튼·배속 선택 제공.
- API 유틸: `features/replay/api.ts`에서 목록/상세/이벤트 다운로드 헬퍼를 제공.
- 타입: `shared/types/replay.ts`에 `ReplaySummary`, `ReplayDetail`, `ReplayEventRecord` 정의.

## 5. 테스트
- `MyReplaysPage.test.tsx`: fetch 모킹 후 목록/검색 필터 동작 검증.
- `ReplayViewerPage.test.tsx`: 메타+NDJSON 모킹, 슬라이더 이동 시 스냅샷 변경 및 컨트롤 표시 검증.

## 6. 오류/예외 처리
- API 실패 시 한국어 에러 메시지로 안내, 부분 로딩 상태에서는 "불러오는 중..." 표시.
- 이벤트가 비어 있으면 재생 버튼은 동작하지 않으며 힌트 문구를 유지한다.

## 7. 추후 확장 포인트
- v0.12.0에서 예정된 리플레이 내보내기/작업 진행도 표시에 대비해 `ReplayDetail`에 다운로드 경로를 유지하고, 포맷 버전을 `eventFormat`으로 구분한다.
