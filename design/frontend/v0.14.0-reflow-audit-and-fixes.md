# v0.14.0 리플로우 감사 및 개선안 (리더보드/작업 목록)

## 1. 목적
- 리더보드, 작업 목록 화면에서 DOM 리플로우/레이아웃 변동을 제어하고 성능을 계량화한다.
- 긴 목록 렌더링 시 페이징/가상 스크롤을 적용해 프레임 드랍과 메모리 사용을 억제한다.
- DevTools Performance 캡처를 통해 변경 전후 지표를 남기고 재현 스크립트를 제공한다.

## 2. 범위
- 대상 화면: `/leaderboard`, `/jobs` (2개 명시)
- 내용: 목록 페이징/가상화, 반복 렌더 시 메모이제이션, WebSocket UI 부하 감소(실시간 표시만 유지)
- 근거: Playwright 캡처 스크립트(`frontend/scripts/captureReflowTrace.js`)로 생성하는 DevTools trace ZIP(저장소에는 바이너리 미포함)

## 3. 외부 동작
### 3.1 리더보드
- 기본 20개씩 페이지 단위로 렌더, 사용자가 10/20/50개 단위 선택 가능.
- 라이브 경기 목록을 `useMemo`로 맵핑하여 동일 데이터 재계산을 방지, 관전 버튼 클릭 시 기존 라우터로 이동.
- 오류 발생 시 한국어 알림 메시지를 노출.

### 3.2 작업 목록
- REST 응답의 `totalItems/totalPages`를 받아 페이지네이션을 렌더하고, 페이지 크기 10/20/50 선택 가능.
- 상단에 총 작업 수를 표시해 페이지 이동 시 레이아웃 변동을 최소화.
- WebSocket 연결은 재시도 제한(3회)으로 안정화했고, 연결 상태를 UI 에러 메시지로 안내.

## 4. 내부 설계
- `LeaderboardPage`: `useMemo`로 라이브 경기 맵 캐시, `pageIndex/pageSize` 상태 추가, 페이징 slice 후 목록 렌더.
- `JobsPage`: `pageIndex/pageSize` 상태 관리 + 서버 total 기반 페이지 버튼, 목록 컨테이너에 `.virtualized` 클래스 적용.
- 스타일: `.list.virtualized`로 최대 높이와 스크롤을 강제, `.pager`로 페이지 버튼의 수평 정렬을 단순화.
- 공통: DOM 읽기/쓰기 반복이 없도록 렌더 단계에서 데이터만 가공하고, 이벤트 핸들러는 상태 업데이트만 수행.

## 5. 성능 캡처 및 비교
- 사전/개선 후 캡처: `frontend/scripts/captureReflowTrace.js` 실행 시 `reports/performance/v0.14.0/` 하위에 로컬로 생성(저장소 커밋 금지)
- 관찰 결과(정성):
  - 리더보드: 최초 렌더 시 DOM 노드 생성 감소, 스크롤 시 레이아웃 thrashing 스택이 사라짐.
  - 작업 목록: 80개 항목을 한 페이지로 렌더할 때보다 페이징으로 레이아웃 재계산 시간이 짧아지고 프레임 드랍이 감소.
- 재현 방법: `frontend/scripts/captureReflowTrace.js` 실행 또는 `browser_container.run_playwright_script`로 포트 8000에 연결하여 동일 API 목킹 후 trace zip 생성.

## 6. 테스트 전략
- 수동: 위 캡처 스크립트로 before/after를 비교하고 DevTools Summary에서 Layout/Recalc Style 비중을 기록.
- 자동: React Testing Library 기반 기존 테스트(`JobsPage.test.tsx`)는 페이지네이션 응답 필드(`totalItems`)를 검증하도록 갱신.
- 회귀: 페이지 크기 변경 시 `pageIndex`를 0으로 리셋하는 로직을 유지해 비어 있는 페이지 렌더를 방지.
