# v0.5.0 친구/초대 프런트엔드 설계

## 1. 목적과 범위
- 친구 목록, 친구 요청, 차단, 초대 UI를 한 화면에서 제공한다.
- NORMAL 매치 초대 수락 시 게임 화면으로 이동하는 흐름을 구현한다.
- WebSocket 이벤트는 구조만 마련되어 있으며, 현재는 REST 폴링(React Query)로 동작한다.

## 2. 사용자 시나리오 요약
- 로그인 사용자는 상단 네비게이션에서 `친구` 메뉴로 이동한다.
- 친구 추가: 아이디 입력 → 요청 전송 → 상대가 수락하면 목록에 표시
- 요청 관리: 받은 요청 수락/거절, 보낸 요청 상태 확인
- 초대: 친구 목록에서 게임 초대 버튼 → 상대가 수락 시 게임 방으로 이동
- 차단: 아이디 입력으로 차단 추가, 목록에서 해제

## 3. 화면 구성
- FriendsPage (새 라우트 `/friends`)
  - 상단 패널: 친구 추가 입력 + 버튼
  - 친구 목록: 온라인/오프라인 배지, 초대 버튼
  - 요청 패널: 좌측(받은 요청) / 우측(보낸 요청)
  - 초대 패널: 좌측(받은 초대, 수락/거절) / 우측(보낸 초대)
  - 차단 관리: 차단 추가 입력, 차단 목록 + 해제 버튼
  - 상태 메시지: 성공/실패 피드백 텍스트

## 4. 상태 관리 및 데이터 흐름
- React Query 기반 서버 상태
  - Query keys: `friends`, `friendRequests`, `blocks`, `incomingInvites`, `outgoingInvites`
  - Mutation 후 관련 Query invalidate로 최신 데이터 반영
- 인증: useAuth에서 token을 받아 모든 API 호출에 Authorization 헤더 전달
- 초대 수락 시 roomId를 확인해 `/game?roomId=<id>`로 이동

## 5. API 매핑
- backend `/api/social` 엔드포인트 사용
  - GET `/friends` → FriendSummary[]
  - GET `/friend-requests` → incoming/outgoing
  - POST `/friend-requests` → 친구 요청 전송
  - POST `/friend-requests/{id}/accept|reject`
  - GET `/blocks`, POST `/blocks`, DELETE `/blocks/{userId}`
  - GET `/invites/incoming|outgoing`
  - POST `/invites` → 초대 생성
  - POST `/invites/{id}/accept|reject`
- `src/features/social/api.ts`에 공통 fetch 래퍼 정의, 에러 시 ApiError throw → statusMessage로 노출

## 6. 컴포넌트/스타일 설계
- `src/pages/FriendsPage.tsx`: 단일 페이지 구성, 각 섹션을 panel로 구분
- 스타일 추가
  - `.friend-item`, `.badge.online|offline`, `.inline-form`, `.grid-two`, `.friend-actions` 등
  - 기본 톤은 기존 lobby/lists 스타일을 유지하며 배지만 녹색/회색으로 상태 구분

## 7. 라우팅/내비게이션
- App.tsx에 `/friends` 라우트 및 네비게이션 링크 추가(인증 사용자 전용)
- 기존 ProtectedRoute를 재사용해 비인증 접근 시 로그인 화면으로 이동

## 8. 테스트 전략
- `FriendsPage.test.tsx`
  - useAuth를 mock해 인증 토큰을 주입하고 fetch를 mock으로 응답
  - 친구 목록/요청 렌더링 확인, 수락 버튼 클릭 시 accept API 호출 여부 검증
- 빌드/테스트 명령
  - `npm test` (Vitest + Testing Library)
  - `npm run build` (Vite 빌드 검증)

## 9. 추후 확장 메모
- `/ws/social` WebSocket 구독을 React Query에 연결해 요청/초대 실시간 갱신 가능
- 친구 목록에서 DM 진입 버튼 추가 시 Chat 도메인(v0.6.0)과 연동 예정
