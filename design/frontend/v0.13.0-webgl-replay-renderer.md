# v0.13.0 WebGL 기반 리플레이 렌더러 설계

## 1. 목적
- 리플레이 뷰어의 기본 렌더링 경로를 WebGL로 전환해 GPU 가속을 활용한다.
- WebGL 초기화 실패/미지원 시 Canvas2D로 자동 폴백해 구형 브라우저나 가상환경에서도 재생이 유지된다.
- 개발 모드에서 1x/2x 평균 FPS를 계측해 GPU 경로 정상 동작 여부를 확인한다.

## 2. 범위
- `ReplayViewerPage` 내 렌더러 교체 및 FPS 계측 UI 추가.
- 공용 컴포넌트 `ReplayRenderer` 신설(WebGL+Canvas2D 이중 경로).
- WebGL/Canvas2D 회귀 테스트 추가.
- UX/레이아웃은 기존 뷰어를 유지하며, 점수/배속/슬라이더 컨트롤 그대로 사용한다.

## 3. 외부 동작
- 페이지 진입 시 WebGL 컨텍스트를 우선 생성하고 실패 시 Canvas2D를 선택한다.
- 현재 렌더링 경로를 화면 힌트로 노출하여 디버깅 가능하게 한다.
- 재생/배속 조작과 연동해 1x/2x 평균 FPS를 개발 모드에서만 보여 준다(콘솔 로그 포함).

## 4. 내부 구성
### 4.1 주요 컴포넌트
- `ReplayRenderer`
  - 캔버스 기반 렌더러. WebGL 초기화 → 실패 시 2D 컨텍스트 획득 순서로 시도한다.
  - WebGL 경로: 단색 배경/중앙 라인/패들/볼을 단순 사각형 쉐이더로 렌더링.
  - Canvas2D 경로: 동일 좌표계를 사용해 즉시 그리기.
  - 렌더링 경로를 `data-renderer-path` 속성으로 표시해 테스트와 디버그에 활용.
- `ReplayViewerPage`
  - 기존 재생/배속/슬라이더/잡 실행 UI 유지.
  - 개발 모드에서 `performance.now()` 기반으로 1x/2x FPS 평균을 누적 계산 후 UI/콘솔에 표시.
  - 렌더러 교체로도 점수 표시는 유지하기 위해 별도 스코어보드 블록을 남긴다.

### 4.2 좌표/스케일 정책
- 코트 기준 좌표: 800x480, 패들 12x80, 볼 12x12.
- 실제 캔버스: 기본 960x540. 비율을 유지하면서 중앙 정렬하며, 남는 여백은 배경색으로 채운다.

## 5. 테스트 전략
- `ReplayRenderer.test.tsx`: WebGL 컨텍스트 모킹 시 `data-renderer-path=webgl`, 실패 시 `canvas2d` 여부 확인.
- `ReplayViewerPage.test.tsx`: 기존 이벤트 로딩/슬라이더/점수 표시 흐름이 깨지지 않는지 DOM 검사.
- 수동 확인: GPU 환경(예: 로컬 RTX/VAAPI)에서 DevTools FPS 확인, GPU 비활성 브라우저(헤드리스/소프트웨어 렌더러)에서도 Canvas2D로 재생되는지 확인.

## 6. 호환/확장 고려
- 향후 파티클/텍스처를 추가해도 WebGL 파이프라인을 재사용할 수 있도록 단일 색상 사각형 렌더를 기본 레이어로 유지한다.
- Canvas2D 폴백은 기능 최소화에 집중하되, 동일 좌표계를 유지해 두 경로 간 시각적 차이를 최소화한다.
- FPS 계측은 개발 모드 한정이며, 운영 모드 확장이 필요하면 별도 토글/메트릭스 수집으로 분리한다.
