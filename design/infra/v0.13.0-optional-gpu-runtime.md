# v0.13.0 선택적 GPU 런타임 가이드

## 1. 목적
- CI는 CPU-only로 유지하되, 로컬/특정 서버에서 GPU 경로(WebGL 렌더러, FFmpeg HW 인코딩)를 검증할 수 있는 체크리스트를 제공한다.
- GPU 의존 기능이 없더라도 서비스가 정상 동작하도록 기본값을 CPU/소프트웨어 경로로 둔다.

## 2. 범위
- Docker Compose/로컬 실행 시 필요한 GPU 설정 안내(선택).
- FFmpeg 하드웨어 지원 확인 명령과 환경 변수(`EXPORT_HW_ACCEL`).
- 클라이언트(WebGL) 확인 방법.

## 3. GPU 옵션 체크리스트
1) 호스트/VM에서 GPU 장치 노출 확인
- NVIDIA: `nvidia-smi` 정상 출력, Docker 사용 시 `--gpus all` 옵션 필요.
- VAAPI: `/dev/dri/renderD128` 존재 및 컨테이너에 마운트.

2) FFmpeg 하드웨어 지원 확인
```bash
ffmpeg -hide_banner -hwaccels
ffmpeg -hide_banner -encoders | grep -E "nvenc|qsv|vaapi|videotoolbox|amf"
```

3) 워커 설정
- `.env` 또는 실행 환경에 `EXPORT_HW_ACCEL=true` 추가.
- VAAPI 사용하는 경우: 컨테이너에 `/dev/dri/renderD128` 마운트 + 필요 시 `LIBVA_DRIVER_NAME` 설정.
- NVENC 사용하는 경우: NVIDIA Container Toolkit 설치 후 `--gpus all`로 compose 실행.

4) 프런트엔드(WebGL) 확인
- Chrome DevTools → Console에 `[replay-fps]` 로그가 주기적으로 출력되는지 확인.
- 화면 하단 "현재 렌더링 경로"가 WebGL로 표시되는지 확인.

5) 실패 시 폴백 확인
- WebGL이 차단된 환경(헤드리스) 또는 `EXPORT_HW_ACCEL=false`로 실행해도 리플레이 재생/MP4 내보내기가 정상 완료되어야 한다.

## 4. CI/배포 정책
- CI 파이프라인은 GPU 없는 러너에서 실행하며, `EXPORT_HW_ACCEL` 기본값은 false.
- GPU 관련 설정은 개발자 로컬/스테이징에서만 사용하며, 운영 반영 시에도 CPU 경로를 항상 유효하게 유지한다.

## 5. 후속 확장 포인트
- 특정 클라우드(GKE/EC2 GPU)별 compose override 파일 추가 가능.
- FFmpeg 하드웨어 디바이스 경로/드라이버 설정을 `.env.gpu`로 분리해 공유하도록 고려한다.
