# v0.6.0 채팅 WebSocket 이벤트 설계

## 1. 엔드포인트
- `ws://<backend>/ws/chat?token=<JWT>`
- JWT 핸드셰이크로 사용자 정보 연결, 접속 시 로비 채널 자동 구독.

## 2. 클라이언트 → 서버 명령
```json
{ "type": "DM_SEND", "targetUserId": 2, "content": "메시지" }
{ "type": "LOBBY_SEND", "content": "전체 채팅" }
{ "type": "MATCH_SEND", "roomId": "room-1", "content": "경기 채팅" }
{ "type": "SUBSCRIBE_MATCH", "roomId": "room-1" }
```
- 유효성 실패 시 close 또는 400 예외 응답 메시지.

## 3. 서버 → 클라이언트 메시지
- 모든 송신은 `ChatMessageResponse` 직렬화 결과.
```json
{
  "id": 12,
  "channelType": "DM",
  "channelKey": "1-2",
  "senderId": 1,
  "senderNickname": "앨리스",
  "recipientId": 2,
  "content": "안녕",
  "createdAt": "2024-01-01T12:00:00"
}
```
- DM: 송신자/수신자 세션에만 전달.
- LOBBY: 로비 구독 세션 전체에 전달.
- MATCH: `SUBSCRIBE_MATCH`로 등록한 roomId 채널 세션에 전달.

## 4. 제재/예외
- `ChatModerationService.isMuted`가 true면 403 응답 후 메시지 저장/브로드캐스트 불가.
- BlockRepository 검사로 상호 차단 관계일 경우 DM 전송 거부.

## 5. 프런트엔드 연동
- `useChatSocket` 훅이 WebSocket을 유지하며 onMessage 콜백으로 UI에 반영.
- 매치 화면은 roomId로 구독, 로비/DM은 기본 세션으로 수신한다.
