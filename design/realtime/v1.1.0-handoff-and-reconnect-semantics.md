# v1.1.0 핸드오프 및 재접속 의미 체계

## 정책 선택
- (B) Deterministic terminate: 스냅샷 복구 없이 종료 근거를 기록하고 클라이언트에 명시적으로 전달.

## 규칙
1. 게이트웨이는 세션별 termination context가 있으면 즉시 `TERMINATED` 후 소켓 종료.
2. 재접속 시 shard heartbeat가 만료되면 termination context(`SHARD_UNAVAILABLE`)를 기록 후 종료.
3. shard는 내부 검증 실패나 악용 탐지 시 `POLICY_TERMINATED`를 기록한다.
4. 정상 종료 시 `NORMAL_COMPLETION`을 기록하며 재접속 요청은 모두 거부된다.

## 타임라인
- `t0` 신규 연결 → `SESSION_CONNECTED`
- `t1` shard ack → `SESSION_ACK`
- `t2` 게임 진행 중 shard kill → heartbeat 만료 → 게이트웨이 `SHARD_UNAVAILABLE`
- `t3` 사용자가 재접속 시도 → termination context 반환 후 종료

## 저장되는 필드
- `sessionId`, `reason`, `occurredAt`, `detail`
- Redis hash `termination:{sessionId}`로 저장, TTL=24h.

## 테스트
- `GatewayShardScaleOutTest.shardKillTriggersDeterministicTerminate`: heartbeat 만료 후 재접속 시 종료 컨텍스트 검증.
- `GatewayShardScaleOutTest.authFailureTerminatesSession`: 인증 실패 컨텍스트 기록 확인.
