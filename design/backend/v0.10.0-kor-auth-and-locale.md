# v0.10.0 백엔드 카카오/네이버 로그인 및 KST/로케일 정비

## 1. 목적/범위
- 카카오/네이버 OAuth 액세스 토큰으로 로그인 흐름을 지원해 한국 시장 환경을 반영한다.
- API 타임스탬프를 KST 기준 ISO-8601(+09:00)으로 통일하고 로케일을 ko_KR로 고정한다.
- DB/로그/직렬화 전 구간에서 utf8mb4와 Asia/Seoul 타임존을 유지한다.

## 2. 외부 동작
- 인증 API
  - `POST /api/auth/oauth/kakao` `{ accessToken }` → 카카오 프로필 조회 후 AuthResponse 반환.
  - `POST /api/auth/oauth/naver` `{ accessToken }` → 네이버 프로필 조회 후 AuthResponse 반환.
  - 기존 `/api/auth/login` / `/api/auth/register`는 그대로 유지.
- 응답 포맷
  - `UserResponse` 등 시간 필드는 `2025-01-05T12:00:00+09:00` 형태의 OffsetDateTime 문자열.
  - `authProvider`, `locale` 필드를 추가해 프런트에서 로그인 출처와 로케일을 표기.
- 오류 정책
  - 외부 프로필 조회 실패 → 401 with 한국어 메시지.
  - 밴/정지 계정 → 403 유지.

## 3. 내부 구조
- 구성/유틸
  - `LocaleConfig`: TimeZone/Locale 기본값을 Asia/Seoul, ko_KR로 지정하고 Jackson 포맷을 ISO-8601(+09:00)로 설정.
  - `KstDateTime`: KST now()/Offset 변환 헬퍼.
  - `OAuthRestTemplateConfig`: 카카오/네이버용 RestTemplate 빈 분리(테스트 시 Mock 주입).
- 서비스/클라이언트
  - `KakaoOAuthClient`, `NaverOAuthClient`: Bearer 토큰으로 프로필 호출, 최소 필드(id, nickname, email, avatar) 매핑.
  - `OAuthLoginService`: 공급자별 프로필을 User 엔티티로 생성/조회하고 AuthResponse 발급.
  - `AuthService`: OAuth 프로필 재사용 메서드 추가, 응답에 authProvider/locale 포함.
- 엔티티/리포지토리
  - `User`: `authProvider`, `providerUserId`, `email`, `locale` 컬럼 추가. OAuth 생성자 제공.
  - `UserRepository`: `findByAuthProviderAndProviderUserId` 추가.
- 보안
  - `/api/auth/oauth/**` 공개 허용, 나머지 규칙 유지.

## 4. 데이터/호환
- MariaDB `utf8mb4_unicode_ci` + `skip-character-set-client-handshake` 조합으로 한글/이모지 호환성 확보.
- JPA `ddl-auto=update`로 신규 컬럼 자동 반영. 기본 locale은 `ko-KR`, authProvider는 null 허용(기존 로컬 사용자).
- Timestamp 직렬화 변경은 OffsetDateTime 문자열로 하위 호환(문자열 파싱 기반 클라이언트는 그대로 동작).

## 5. 테스트
- `OAuthLoginServiceTest`
  - 카카오 액세스 토큰 → 신규 사용자 생성, JWT 파싱 가능 여부, +09:00 오프셋 확인.
  - 네이버 액세스 토큰 → 동일 토큰 재요청 시 계정 재사용, locale 값 확인.
- 기존 `AuthServiceTest`/통합 테스트는 JWT 발급/밴/정지 시나리오를 유지.

## 6. 추후 과제
- 실제 운영 시 OAuth 클라이언트/시크릿을 별도 설정으로 분리하고 토큰 교환 단계(authorization code)를 추가.
- 다국어 확장 필요 시 locale 필드를 기반으로 i18n 스위치 전략을 설계.
