# v1.0.0 백엔드 오버뷰

## 1. 목적
- v0.1.0~v0.14.0까지 추가된 인증/랭킹/소셜/토너먼트/관전/잡 파이프라인을 통합해 **포트폴리오 제출용 안정화 상태**를 요약한다.
- 주요 REST/WebSocket 계약, 도메인 책임, 운영 시나리오를 한 눈에 파악할 수 있도록 한다.

## 2. 범위 및 주요 흐름
- 회원가입/로그인 → 프로필 갱신 → 게임 매칭/플레이 → 전적/랭킹 조회
- 친구 추가/차단 → 초대 → 실시간 채팅 → 토너먼트 참가/시작 → 관전/잡 진행 알림
- 관리자: 사용자/매치 조회, 제재(BAN/MUTE), 운영 로그 확인

## 3. 아키텍처 요약
- Spring Boot 3.x + Java 17, 도메인 모듈 분리 (auth, user, game, rank, social, chat, tournament, replay, job, admin).
- 인증: JWT 기반. 기본 ID/비밀번호 + 카카오/네이버 OAuth 연동(OAuth 프로필만 사용, 토큰 검증 실패 시 401).
- 영속계층: MariaDB(JPA)로 사용자/매치/랭킹/토너먼트/리플레이 메타 저장, Redis로 세션/매칭/채팅 방 상태 캐싱.
- WebSocket 엔드포인트: `/ws/game`, `/ws/social`, `/ws/chat`, `/ws/tournament`, `/ws/jobs`, `/ws/echo`(헬스/테스트).
- 게임 엔진: 50ms 틱 루프, 서버 권한 모델, `GameRoomService`가 매치 타입(NORMAL/RANKED)별 roomId 발급 및 종료 처리.
- 잡/리플레이: Redis Streams 기반 비동기 큐, `replay-worker`가 ffmpeg로 리플레이/익스포트 작업 수행.

## 4. 핵심 도메인 정리
- Auth/User
  - `AuthService`가 등록/로그인/토큰 발급, `OAuthLoginService`가 공급자 프로필을 계정에 매핑.
  - `UserService`가 프로필 조회/수정, 차단 목록 연동.
- Game/Match/Rank
  - `MatchmakingService`가 큐 등록/배정, `GameRoomService`가 roomId 생성·파기 및 점수 반영.
  - `RankService`가 Elo 기반 점수 업데이트, `RankingController`가 리더보드 페이지네이션 제공.
- Social/Chat
  - 친구 요청/수락/차단, 소셜 알림을 WebSocket으로 push.
  - 채팅 채널은 방 단위로 Redis pub/sub 사용, 금칙어 필터와 mute 상태를 검사.
- Tournament/Spectator
  - 생성자만 시작 가능하며 정원 충족 시 브래킷 고정, 각 매치마다 game room 자동 생성.
  - 관전자 역할은 read-only로 동일 `/ws/game` 핸들러에서 분기 처리.
- Admin/Monitoring
  - 관리자 토큰으로 사용자 상태 변경/로그 열람. Prometheus scrape와 Grafana 대시보드 샘플 제공.

## 5. 안정화 포인트
- UTF-8/KST 기본값을 전체 계층에 강제(`utf8mb4_unicode_ci`, `TZ=Asia/Seoul`).
- WebSocket 핸드셰이크에서 JWT 필수, room 참가자/관전자 검증 실패 시 즉시 종료.
- 잡 스트림은 consumer group 기반으로 처리하여 중복 소비를 방지하고, 실패 시 프로그레스 이벤트에 오류 코드 포함.
- 통합 테스트:
  - `IntegrationSmokeTest`: REST/WS 헬스 체크 및 기본 매칭 플로우 검증.
  - `JobFlowTest`: 잡 요청→워커 이벤트 파이프라인 검증(Testcontainers Redis).
  - `Utf8RegressionTest`: 한글/이모지 인코딩 보존 검증.

## 6. 남은 제한사항
- OAuth는 프로필 API 호출까지만 지원하며, 실제 프로덕션용 동의 절차/토큰 검증 로깅은 최소 수준이다.
- 게임/관전은 단일 인스턴스 메모리 룸 관리에 의존하며, 멀티 인스턴스 간 상태 동기화는 구성되어 있지 않다.
- 채팅/소셜 알림은 기본 금칙어 필터 외 고급 모더레이션(스팸 감지, 신고 워크플로)은 미구현이다.
- 관리자 기능은 조회/간단한 제재 중심이며, 감시 대시보드는 샘플 패널 수준이다.
