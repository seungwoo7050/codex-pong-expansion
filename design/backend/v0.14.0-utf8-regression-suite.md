# v0.14.0 UTF-8 회귀 테스트 설계

## 1. 목적
- v0.10.0에서 요구한 `utf8mb4` 전 구간 보장을 회귀 테스트로 고정한다.
- 한글+이모지 닉네임과 잡/리플레이 메타데이터가 REST, WebSocket, DB 왕복 시 손상되지 않음을 자동 검증한다.

## 2. 범위
- 인코딩 설정: Spring Boot/JPA 기본 UTF-8, MariaDB `utf8mb4_unicode_ci` 전제.
- 경로: 회원 가입/로그인, 프로필 갱신, `/ws/echo` WebSocket, UserRepository DB 조회.
- 추가 대상: 잡/리플레이 메타데이터는 후속 버전(v0.12.x) API 구조를 따르되 문자열 인코딩 검증에 집중.

## 3. 테스트 시나리오
- `Utf8RegressionTest` (통합 테스트, 랜덤 포트):
  1) 닉네임 `코딩😀선수`로 회원 가입 + 로그인 → 응답 바디의 nickname이 동일한지 확인.
  2) `GET /api/users/me` 응답과 DB(`UserRepository`) 저장 값이 동일한지 확인.
  3) `PUT /api/users/me`에 `페이로드🚀테스트`를 전송 → 응답/DB 모두 업데이트된 닉네임으로 반영.
  4) WebSocket `ws://localhost:{port}/ws/echo?token=...`로 `"잡 알림 ✅🔥"` 전송 → echo payload에 동일 문자열이 포함되는지 확인.
- 테스트는 `@SpringBootTest(webEnvironment = RANDOM_PORT)`로 기동하며, 외부 인프라 의존성 없이 내장 서버+H2/MariaDB 테스트 설정을 사용한다.

## 4. 실행 방법
```bash
cd backend
./gradlew test --tests com.codexpong.backend.Utf8RegressionTest
```
- Testcontainers 미사용 환경에서도 실행 가능하도록 간단한 REST/WS 플로우만 포함했다.

## 5. 회귀 방지 포인트
- REST 컨트롤러/DTO에 `@JsonProperty` 등 인코딩 변경 요소를 추가할 때 위 테스트를 병행 실행한다.
- DB 마이그레이션 시 문자 집합이 변경되면 테스트가 실패할 수 있으므로, 스키마 변경 전에 `utf8mb4` 유지 여부를 확인한다.
- WebSocket 핸들러 로직을 수정할 때 echo/브로드캐스트 경로가 문자열을 그대로 전달하는지 점검한다.
